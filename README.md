# MachLearning
Под временным рядом понимаются последовательно измеренные через некоторые (зачастую равные) промежутки времени данные.
Ряд yt называется слабо стационарным (weak stationarity) или стационарным в широком смысле, если такие статистические характеристики
временного ряда как его математическое ожидание (среднее), дисперсия (ср. кв. отклонение) и ковариация не зависят от момента времени
E[y] = Const, D[y] = Const, Cov[yk, y(k-1)] = R(k)
Если нарушается хотя бы одно из этих условий, то ряд называется нестационарныь.

Скользящая средняя (Moving Average - MA) - среднее арифметическое значений исходной функции за установленный период. Скользящие средние позволяют сгладить как случайные, так и периодические колебания, выявить имеющуюся тенденцию в развитии процесса.

### Тест Дики-Фуллера
*Тест Дики-Фуллера* используется для проверки ряда на стационарность. Он проверяет ряд на наличие так называемых единичных корней.
Временной ряд имеет *единичный корень* (хотя бы один), если его первые разности образуют стационарный ряд.

*Обозн.* y(t) ~ I(1), т.е. Δy(t)=y(t)-y(t-1) ~ I(0), где Δ - разностный оператор, I(j) - означает, что ряд является интегрированным порядка j, I(0) - ряд стационарен.
Временной ряд называется *интегрированным порядка `k`*, если разности ряда k-го порядка `Δ^k x(t)` являются стационарными, а разности меньшего порядка (и сам временной ряд) не являются стационарными рядами.
* Δ yk   = y(k+1) - yk
* Δ^2 yk = Δ y(k+1) - Δ yk = y(k+2) - 2y(k+1) + yk
* Δ^m yk = Δ^m-1 y(k+1) - Δ^m-1 yk, где Δ - разностный оператор

*Обозн.* yk ~ I(k) - интегрированный временной ряд порядка k

Вообще говоря, тест Дики-Фуллера проверяет значение коэффициента `a` в авторегрессионном уравнении 1-го порядка. Оно имеет вид:

y(t) = a * y(t-1) + ε(t), ε(t) - ошибка
* a=1   => есть единичные корни => стационарности нет
* |a|<1 => нет единичных корней => есть стационарность
* |a|>1 => не свойственно для временных рядов, которые встречаются в реальной жизни - требуется более сложный анализ

Преобразуем уравнение:

y(t) = a * y(t-1) + ε(t)
y(t) - y(t-1) = a * y(t-1) - y(t-1) + ε(t)
Δy(t) = (a-1) * y(t-1) + ε(t)
**Δy(t) = b * y(t-1) + ε(t)**, где b=a-1

Сформулируем основную и альтернативную гипотезы:
* Основная гипотеза: H0: b=0 - существует единичный корень, ряд нестационарный.
* Альтернативаная гипотеза: H1: b<0 - единичного корня нет, ряд стационарный

Для того чтобы проверить временной ряд y на порядок интегрируемости, следует рассчитать значение t-статистики Стьюдента для
параметра b и сравнить его с верхним и нижним критическими значениями DF-статистики из таблицы теста Дики-Фуллера. Если для n наблюдений
значение расчетной t-статистики sm.tsa.adfuller(ts) меньше, чем нижнее критическое значение, нулевую гипотезу b=0 отклоняют и принимают альтернативную о стационарности процесса yt. В противном случае, нулевая гипотеза не может быть отклонена. Если нулевая гипотеза не отклоняется, можно лишь утверждать, что процесс yt нестационарен, т.е. либо он интегрируем более высокого порядка, либо неинтегрируем вообще.

### Тренд, сезональность, остаток. Аддитивная и мультипликативная модели

*Трендовая* составляющая отражает влияние долговременных факторов и соответствует устойчивой и долговременной тенденции изменения временного ряда.
*Сезонная* компонента s(τ i) связана с наличием факторов, действующих с заранее известной периодичностью. Это регулярные колебания, которые носят периодический или близкий к нему характер.
*Остатком* временного ряда называется разница между предсказанным и наблюдаемым значением.

* Общий вид *аддитивной модели*: Y = T + S + E;
* Общий вид *мультипликативной модели*: Y = T * S * E;
* T - тренд, S - сезональность, E - остаток
### Преобразование Бокса-Кокса
Попробуем применить преобразование, чтобы приблизить имеющееся распределение к нормальному. Будем использовать преобразование Бокса-Кокса (логарифмирование – это частный случай трансформации Бокса-Кокса) 
y_new=(y^p−1)/p , если p≠0 
y_new=ln(y), если p=0


### Библиотеки и функции
 
 * statsmodels - представляет собой пакет Python, который позволяет пользователям исследовать данные, оценивать статистические модели и выполнять статистические тесты;
   * graphics.plot_acf(df,...) построение графика автокорреляции ряда df;
   * graphics.plot_pacf(df,...) построение графика частичной автокорреляции ряда df;
   * seasonal.seasonal_decompose(df, model) разложение временного ряда на сезонность, тренд и остаток в соответсвии с заданной моделью model; 
   * adfuller(df) - тест Дики-Фулера для ряда df;
   * scipy.stats.boxcox(x, lmbda,...) - Трансформация Бокса — Кокса (Box-Cox transformation)
   * ARIMA(df, order) построение модели ARIMA с параметрами order;
   * SARIMAX(df, order, seasonal_order) построение модели SARIMA с параметрами order и сезонными параметрами seasonal_order;
 * sklearn - инструменты для машинного обучения и анализа данных;
   * r2_score(true, pred) функция регрессионной оценки с истинными значениями true и предсказнными pred;
scipy.stats.boxcox(x, lmbda=None, alpha=None)[source]
Return a positive dataset transformed by a Box-Cox power transformation.

